<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: white;
            z-index: -2;
            transform: translateZ(0);
        }

        .base {
            margin-top: 80px;
            background-color: white;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            transform: translateZ(0);
            padding-bottom: 60px;
            box-sizing: border-box;
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }

        #base-home {
            z-index: 0;
            opacity: 1;
        }

        /* Top header with hamburger and other icons */
        .top-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 80px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1rem;
            z-index: 10;
            transition: transform 0.3s ease-in-out;
            box-sizing: border-box;
        }

        .hamburger-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 12px;
            background-color: #E8F2FF;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .right-icons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 12px;
            background-color: #E8F2FF;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Sliding menu panel */
        .menu-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 75vw;
            height: 100vh;
            background-color: white;
            z-index: 20;
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 2rem 1.5rem;
            box-sizing: border-box;
        }

        .menu-panel.open {
            transform: translateX(0);
        }

        .menu-item {
            display: block;
            padding: 1.5rem 0;
            font-size: 1.2rem;
            color: #333;
            text-decoration: none;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            font-family: inherit;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background-color: #f8f9fa;
        }

        /* Content wrapper for sliding effect */
        .content-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            transition: transform 0.3s ease-in-out;
            z-index: 1;
        }

        .content-wrapper.shifted {
            transform: translateX(75vw);
        }

        /* Menu overlay for closing */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 15;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .menu-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 60px;
            display: flex;
            align-items: center;
            z-index: 1;
            padding-block: 1rem;
        }

        .navbar button {
            background: none;
            border: none;
            cursor: pointer;
        }

        .signin-container {
            display: flex;
            flex-direction: column;
            max-width: 500px;
            margin-inline: auto;
        }

        .content-container {
            margin-top: 60px;
        }

        .view {
            /* padding: 2rem; */
            position: fixed;
            background-color: white;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -3;
            transform: translateZ(0);
            transition: left 0.3s ease-in-out, transform 0.3s ease-in-out;
        }

        #view2 {
            background-color: blue;
            color: white;
        }

        #view3 {
            background-color: green;
            color: white;
            height: 70vh;
            bottom: 0;
            top: auto;
        }

        #view4 {
            background-color: rgb(255, 179, 0);
            color: white;
        }

        .cards-container {
            max-width: 35rem;
            margin: 0 auto;
            padding-inline: 1rem;
        }

        .card {
            background: white;
            overflow: hidden;
            margin-bottom: 1.75rem;
            display: flex;
            height: 9.35rem;
        }

        .card-image {
            width: 8.75rem;
            object-fit: cover;
            object-position: bottom;
            flex-shrink: 0;
            border-radius: 1rem;
        }

        .card-content {
            padding: 0 .5rem 0 .75rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 4px;
        }

        .card-title-section {
            display: flex;
            align-items: baseline;
            width: 100%;
        }

        .card-title {
            font-size: 20px;
            font-weight: bold;
            color: #212121;
            margin: 0;
        }

        .card-space-size {
            font-size: 16px;
            color: #000;
            font-weight: 500;
            margin-left: auto;
        }

        .card-location {
            font-size: 18px;
            color: #4B4B4B;
            font-weight: 500;
            margin: 0 0 1rem 0;
        }

        .card-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .rating {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .star-icon {
            width: 16px;
            height: 16px;
        }

        .rating-number {
            font-size: 16px;
            color: #4B4B4B;
            font-weight: 500;
        }

        .duration {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 16px;
            color: #4B4B4B;
            font-weight: 500;
        }

        .calendar-icon {
            width: 16px;
            height: 16px;
        }

        .card-bottom {
            display: flex;
            justify-content: space-between;
            align-items: end
        }

        .discount-badge {
            background: #E8F5E8;
            color: #2D5A2D;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 15px;
            font-weight: bold;
        }

        .price-section {
            text-align: right;
        }

        .price {
            font-size: 28px;
            font-weight: bold;
            color: #000;
            margin: 0;
        }

        .price-period {
            font-size: 12px;
            color: #A5A5A5;
            margin: 0;
            font-weight: 500;
        }

        .text-input {
            position: relative;
            width: 100%;
            margin-bottom: 0.75rem;
            display: block;
        }

        .text-input input {
            width: 100%;
            height: 3.25rem;
            padding: 1.25rem 3rem 0.5rem 1rem;
            background-color: #e8e8ed;
            color: #000;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            outline: none;
            caret-color: #007aff;
            box-sizing: border-box;
            font-family: inherit;
        }

        .text-input input::placeholder {
            color: transparent;
        }

        .text-input input:focus {
            background-color: #e0e0e5;
        }

        .text-input input:focus+label,
        .text-input input:not(:placeholder-shown)+label {
            top: 0.5rem;
            font-size: 0.75rem;
            color: #666;
            font-weight: 400;
        }

        .text-input label {
            position: absolute;
            left: 1rem;
            top: 1.125rem;
            color: #666;
            font-size: 16px;
            pointer-events: none;
            transition: all 0.2s ease;
            font-weight: 400;
        }

        .text-input .clear-button {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            visibility: hidden;
            width: 26px;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: transparent;
        }

        .text-input .clear-button:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .text-input .clear-button svg {
            width: 26px;
            height: 26px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2rem;
            font-weight: 600;
            margin: 2rem 0 2rem 0;
            color: #000;
        }

        .continue-button {
            width: 100%;
            height: 3.25rem;
            background-color: #007aff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1.5rem;
            font-family: inherit;
        }

        .continue-button:hover {
            background-color: #0056cc;
        }

        .continue-button:active {
            background-color: #004bb5;
        }

        .circle-button {
            position: relative;
            width: 52px;
            height: 52px;
            background-color: #F0F6FF;
            color: #0062FF;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
        }

        .circle-button svg {
            display: block;
        }
    </style>
</head>

<body>
    <div class="background"></div>

    <!-- Menu overlay for closing -->
    <div class="menu-overlay" id="menuOverlay"></div>

    <!-- Sliding menu panel -->
    <div class="menu-panel" id="menuPanel">
        <button class="menu-item" data-base="base-home">Home</button>
        <button class="menu-item" data-base="base-search">Search</button>
        <button class="menu-item" data-base="base-settings">Settings</button>
        <button class="menu-item" id="open-view1" data-view="view1">Signin</button>
    </div>

    <!-- Content wrapper for sliding effect -->
    <div class="content-wrapper" id="contentWrapper">
        <!-- Top header with hamburger menu -->
        <div class="top-header">
            <button class="hamburger-button" id="hamburgerButton">
                <svg width="24" height="13" viewBox="0 0 24 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 2H22M2 11H22" stroke="#0062FF" stroke-width="2.5" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </button>

            <div class="right-icons">
                <button class="icon-button">
                    <svg width="22" height="26" viewBox="0 0 22 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M18.2144 25.5L18.2144 21.7661C20.3091 21.3107 21.8573 19.4893 21.8573 17.3036C21.8573 15.1179 20.3091 13.2964 18.2144 12.8411L18.2144 -1.59234e-07L16.393 -2.38851e-07L16.393 12.8411C14.2984 13.2964 12.7502 15.1179 12.7502 17.3036C12.7502 19.4893 14.2984 21.3107 16.393 21.7661L16.393 25.5L18.2144 25.5ZM14.5716 17.3036C14.5716 15.7554 15.7555 14.5714 17.3037 14.5714C18.8519 14.5714 20.0359 15.7554 20.0359 17.3036C20.0359 18.8518 18.8519 20.0357 17.3037 20.0357C15.7555 20.0357 14.5716 18.8518 14.5716 17.3036Z"
                            fill="#0062FF" />
                        <path
                            d="M3.64301 -2.38852e-07L3.64301 3.73393C1.54837 4.18929 0.000157094 6.01071 0.000156998 8.19643C0.000156902 10.3821 1.54837 12.2036 3.64301 12.6589L3.64301 25.5L5.46444 25.5L5.46444 12.6589C7.55908 12.2036 9.1073 10.3821 9.1073 8.19643C9.1073 6.01071 7.55909 4.18929 5.46444 3.73393L5.46444 -1.59234e-07L3.64301 -2.38852e-07ZM7.28587 8.19643C7.28587 9.74464 6.10194 10.9286 4.55373 10.9286C3.00551 10.9286 1.82159 9.74464 1.82159 8.19643C1.82159 6.64821 3.00551 5.46429 4.55373 5.46429C6.10194 5.46429 7.28587 6.64821 7.28587 8.19643Z"
                            fill="#0062FF" />
                    </svg>
                </button>

                <button class="icon-button">
                    <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M15.7433 15.7601L21.3333 21.3333M18.1111 10.0556C18.1111 14.5045 14.5045 18.1111 10.0556 18.1111C5.60659 18.1111 2 14.5045 2 10.0556C2 5.60659 5.60659 2 10.0556 2C14.5045 2 18.1111 5.60659 18.1111 10.0556Z"
                            stroke="#0062FF" stroke-width="2.14815" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
            </div>
        </div>

        <div id="base-home" class="base">
            <div class="cards-container">
                <div class="card">
                    <img src="https://images.pexels.com/photos/3612412/pexels-photo-3612412.jpeg" alt="Storage shed"
                        class="card-image">

                    <div class="card-content">
                        <div>
                            <div class="card-header">
                                <div class="card-title-section">
                                    <span class="card-title">Storage shed</span>
                                    <span class="card-space-size">10×22</span>
                                </div>
                            </div>

                            <p class="card-location">Helsinki, Uusimaa</p>

                            <div class="card-info">
                                <div class="rating">
                                    <svg class="star-icon" width="16" height="16" viewBox="0 0 16 16" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                            d="M7.091 1.40749C7.427 0.599744 8.573 0.599744 8.909 1.40749L10.4705 5.16199L14.5235 5.48749C15.3965 5.55724 15.7505 6.64624 15.0853 7.21624L11.9975 9.86149L12.9403 13.8162C13.1435 14.6682 12.2173 15.341 11.4703 14.885L8 12.7655L4.52975 14.885C3.78275 15.341 2.8565 14.6675 3.05975 13.8162L4.0025 9.86149L0.914752 7.21624C0.249502 6.64624 0.603502 5.55724 1.4765 5.48749L5.5295 5.16199L7.091 1.40749Z"
                                            fill="#F8C600" />
                                    </svg>
                                    <span class="rating-number">4.9</span>
                                </div>

                                <div class="duration">
                                    <svg class="calendar-icon" width="16" height="16" viewBox="0 0 16 16" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                            d="M4.0625 0.6875C4.21168 0.6875 4.35476 0.746763 4.46025 0.852252C4.56574 0.957742 4.625 1.10082 4.625 1.25V2.375H11.375V1.25C11.375 1.10082 11.4343 0.957742 11.5398 0.852252C11.6452 0.746763 11.7883 0.6875 11.9375 0.6875C12.0867 0.6875 12.2298 0.746763 12.3352 0.852252C12.4407 0.957742 12.5 1.10082 12.5 1.25V2.375H13.0625C13.6592 2.375 14.2315 2.61205 14.6535 3.03401C15.0754 3.45597 15.3125 4.02826 15.3125 4.625V13.0625C15.3125 13.6592 15.0754 14.2315 14.6535 14.6535C14.2315 15.0754 13.6592 15.3125 13.0625 15.3125H2.9375C2.34076 15.3125 1.76847 15.0754 1.34651 14.6535C0.924553 14.2315 0.6875 13.6592 0.6875 13.0625V4.625C0.6875 4.02826 0.924553 3.45597 1.34651 3.03401C1.76847 2.61205 2.34076 2.375 2.9375 2.375H3.5V1.25C3.5 1.10082 3.55926 0.957742 3.66475 0.852252C3.77024 0.746763 3.91332 0.6875 4.0625 0.6875ZM14.1875 7.4375C14.1875 7.13913 14.069 6.85298 13.858 6.642C13.647 6.43103 13.3609 6.3125 13.0625 6.3125H2.9375C2.63913 6.3125 2.35298 6.43103 2.142 6.642C1.93103 6.85298 1.8125 7.13913 1.8125 7.4375V13.0625C1.8125 13.3609 1.93103 13.647 2.142 13.858C2.35298 14.069 2.63913 14.1875 2.9375 14.1875H13.0625C13.3609 14.1875 13.647 14.069 13.858 13.858C14.069 13.647 14.1875 13.3609 14.1875 13.0625V7.4375Z"
                                            fill="black" />
                                    </svg>
                                    <span>12 months rented</span>
                                </div>
                            </div>
                        </div>

                        <div class="card-bottom">
                            <div class="discount-badge">50% off first month</div>

                            <div class="price-section">
                                <p class="price">€32</p>
                                <p class="price-period">per month</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="base-search" class="base">
            <h1>Search View</h1>
            <p>This is the search base view.</p>
        </div>

        <div id="base-settings" class="base">
            <h1>Settings View</h1>
            <p>This is the settings base view.</p>
        </div>
    </div>

    <div id="view1" class="view">
        <div class="signin-container">
            <div class="navbar">
                <button id="close-view1" data-view="view1">
                    <span class="circle-button">
                        <svg width="13" height="19" viewBox="1 0 11 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9.5 17L2 9.5L9.5 2" stroke="currentColor" stroke-width="2.5"
                                stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </span>
                </button>
            </div>
            <div class="content-container">
                <h1>Sign in</h1>

                <div class="text-input">
                    <input id="email" type="email" placeholder=" " value="">
                    <label for="email">Email</label>
                    <div class="clear-button">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M13 0C5.82 0 0 5.82 0 13C0 20.18 5.82 26 13 26C20.18 26 26 20.18 26 13C26 5.82 20.18 0 13 0ZM10.7067 9.29333C10.6151 9.19508 10.5047 9.11628 10.3821 9.06163C10.2594 9.00697 10.127 8.97758 9.9927 8.97521C9.85843 8.97284 9.72505 8.99754 9.60054 9.04784C9.47602 9.09813 9.36291 9.17299 9.26795 9.26795C9.17299 9.36291 9.09813 9.47602 9.04784 9.60054C8.99754 9.72505 8.97284 9.85843 8.97521 9.9927C8.97758 10.127 9.00697 10.2594 9.06163 10.3821C9.11628 10.5047 9.19508 10.6151 9.29333 10.7067L11.5867 13L9.29333 15.2933C9.19508 15.3849 9.11628 15.4953 9.06163 15.6179C9.00697 15.7406 8.97758 15.873 8.97521 16.0073C8.97284 16.1416 8.99754 16.2749 9.04784 16.3995C9.09813 16.524 9.17299 16.6371 9.26795 16.7321C9.36291 16.827 9.47602 16.9019 9.60054 16.9522C9.72505 17.0025 9.85843 17.0272 9.9927 17.0248C10.127 17.0224 10.2594 16.993 10.3821 16.9384C10.5047 16.8837 10.6151 16.8049 10.7067 16.7067L13 14.4133L15.2933 16.7067C15.3849 16.8049 15.4953 16.8837 15.6179 16.9384C15.7406 16.993 15.873 17.0224 16.0073 17.0248C16.1416 17.0272 16.2749 17.0025 16.3995 16.9522C16.524 16.9019 16.6371 16.827 16.7321 16.7321C16.827 16.6371 16.9019 16.524 16.9522 16.3995C17.0025 16.2749 17.0272 16.1416 17.0248 16.0073C17.0224 15.873 16.993 15.7406 16.9384 15.6179C16.8837 15.4953 16.8049 15.3849 16.7067 15.2933L14.4133 13L16.7067 10.7067C16.8049 10.6151 16.8837 10.5047 16.9384 10.3821C16.993 10.2594 17.0224 10.127 17.0248 9.9927C17.0272 9.85843 17.0025 9.72505 16.9522 9.60054C16.9019 9.47602 16.827 9.36291 16.7321 9.26795C16.6371 9.17299 16.524 9.09813 16.3995 9.04784C16.2749 8.99754 16.1416 8.97284 16.0073 8.97521C15.873 8.97758 15.7406 9.00697 15.6179 9.06163C15.4953 9.11628 15.3849 9.19508 15.2933 9.29333L13 11.5867L10.7067 9.29333Z"
                                fill="#505062" />
                        </svg>
                    </div>
                </div>

                <button class="continue-button">Continue</button>

                <script>
                    function textInputSetup(element) {
                        const input = element.querySelector("input");
                        const clearButton = element.querySelector(".clear-button");

                        function updateClearButton() {
                            clearButton.style.visibility = input.value ? "visible" : "hidden";
                        }

                        input.addEventListener("input", updateClearButton);
                        input.addEventListener("focus", updateClearButton);
                        input.addEventListener("blur", updateClearButton);

                        clearButton.addEventListener("click", () => {
                            input.value = "";
                            clearButton.style.visibility = "hidden";
                            input.focus();
                        });

                        updateClearButton();
                    }

                    const textInputs = document.querySelectorAll(".text-input");
                    textInputs.forEach(textInputSetup);
                </script>

                <button id="open-view2" data-view="view2">Open view 2 (from right)</button>
                <br><br>
                <button id="open-view3" data-view="view3">Open view 3 (from bottom)</button>
                <br><br>
            </div>
        </div>
    </div>

    <div id="view2" class="view">
        <h1>View 2</h1>
        <p>This view was opened from view 1 (slides from right)</p>
        <button id="open-view4" data-view="view4">Open view 4 (from right)</button>
        <br><br>
        <button id="close-view2" data-view="view2">Close view 2</button>
    </div>

    <div id="view3" class="view">
        <h1>View 3</h1>
        <p>This view was opened from view 1 (slides from bottom)</p>
        <button id="close-view3" data-view="view3">Close view 3</button>
    </div>

    <div id="view4" class="view">
        <h1>View 4</h1>
        <p>This view was opened from view 2 (slides from right)</p>
        <button id="close-view4" data-view="view4">Close view 4</button>
    </div>

    <script>
        let viewStack = [];
        let currentZIndex = 2; // Start above navbar
        const viewAnimations = {};
        let currentBase = 'base-home';
        let isMenuOpen = false;

        // Hamburger menu functionality
        function openMenu() {
            if (isMenuOpen) return;

            const menuPanel = document.getElementById('menuPanel');
            const contentWrapper = document.getElementById('contentWrapper');
            const menuOverlay = document.getElementById('menuOverlay');

            menuPanel.classList.add('open');
            contentWrapper.classList.add('shifted');
            menuOverlay.classList.add('visible');

            isMenuOpen = true;
            saveState();
        }

        function closeMenu() {
            if (!isMenuOpen) return;

            const menuPanel = document.getElementById('menuPanel');
            const contentWrapper = document.getElementById('contentWrapper');
            const menuOverlay = document.getElementById('menuOverlay');

            menuPanel.classList.remove('open');
            contentWrapper.classList.remove('shifted');
            menuOverlay.classList.remove('visible');

            isMenuOpen = false;
            saveState();
        }

        function openView(viewId, direction = 'right') {
            const targetDiv = document.getElementById(viewId);
            if (!targetDiv || viewStack.includes(viewId)) return;

            viewAnimations[viewId] = direction;
            targetDiv.style.transition = "none";
            targetDiv.style.zIndex = currentZIndex++;

            if (direction === 'bottom') {
                targetDiv.style.bottom = "0";
                targetDiv.style.top = "auto";
                targetDiv.style.transform = "translateY(100%)";
            } else {
                targetDiv.style.left = "100%";
                targetDiv.style.top = "0";
            }

            targetDiv.offsetHeight; // force reflow

            if (direction === 'bottom') {
                targetDiv.style.transition = "transform 0.3s ease-in-out";
                targetDiv.style.transform = "translateY(0)";
                setTimeout(() => {
                    document.addEventListener('click', handleOutsideClick);
                }, 300);
            } else {
                targetDiv.style.transition = "left 0.3s ease-in-out";
                targetDiv.style.left = "0%";
            }

            viewStack.push(viewId);
            saveState();
            closeMenu();
        }

        function closeView(viewId) {
            const targetDiv = document.getElementById(viewId);
            if (!targetDiv || !viewStack.includes(viewId)) return;

            const direction = viewAnimations[viewId] || 'right';

            if (direction === 'bottom') {
                targetDiv.style.transform = "translateY(100%)";
                setTimeout(() => {
                    targetDiv.style.zIndex = -3;
                    targetDiv.style.transform = "translateY(0)";
                    delete viewAnimations[viewId];
                    viewStack = viewStack.filter(id => id !== viewId);
                    saveState();
                    if (viewStack.length === 0) currentZIndex = 2;
                    const hasBottomView = viewStack.some(id => viewAnimations[id] === 'bottom');
                    if (!hasBottomView) document.removeEventListener('click', handleOutsideClick);
                }, 300);
            } else {
                targetDiv.style.left = "100%";
                setTimeout(() => {
                    targetDiv.style.zIndex = -3;
                    targetDiv.style.left = "0%";
                    delete viewAnimations[viewId];
                    viewStack = viewStack.filter(id => id !== viewId);
                    saveState();
                    if (viewStack.length === 0) currentZIndex = 2;
                }, 300);
            }
        }

        function handleOutsideClick(event) {
            viewStack.forEach(id => {
                if (viewAnimations[id] === 'bottom') {
                    const view = document.getElementById(id);
                    if (!view.contains(event.target)) closeView(id);
                }
            });
        }

        function switchBaseView(baseId) {
            if (baseId === currentBase) return;

            const currentBaseDiv = document.getElementById(currentBase);
            const newBaseDiv = document.getElementById(baseId);
            const backgroundDiv = document.querySelector('.background');

            currentBaseDiv.style.opacity = "0";
            currentBaseDiv.style.zIndex = -1;
            backgroundDiv.style.zIndex = -1; // Move background behind new base
            setTimeout(() => {
                newBaseDiv.style.opacity = "1";
                newBaseDiv.style.zIndex = 0;
                backgroundDiv.style.zIndex = -1; // Ensure background stays behind new base
                currentBase = baseId;
                saveState();
            }, 300);
        }

        // Load saved state on page load
        function loadState() {
            const savedViewStack = localStorage.getItem('viewStack');
            const savedAnimations = localStorage.getItem('viewAnimations');
            const savedBase = localStorage.getItem('currentBase');
            const savedMenuState = localStorage.getItem('isMenuOpen');

            if (savedViewStack) {
                const views = JSON.parse(savedViewStack);
                const animations = savedAnimations ? JSON.parse(savedAnimations) : {};

                views.forEach(viewId => {
                    const targetDiv = document.getElementById(viewId);
                    if (!targetDiv) return;

                    const direction = animations[viewId] || 'right';
                    viewAnimations[viewId] = direction;

                    // Set position immediately without animation
                    targetDiv.style.transition = "none";
                    targetDiv.style.zIndex = currentZIndex++;

                    if (direction === 'bottom') {
                        targetDiv.style.bottom = "0";
                        targetDiv.style.top = "auto";
                        targetDiv.style.transform = "translateY(0)";
                    } else {
                        targetDiv.style.left = "0%";
                        targetDiv.style.top = "0";
                    }

                    viewStack.push(viewId);
                });

                // Add outside click listener if any bottom views were restored
                const hasBottomView = views.some(id => animations[id] === 'bottom');
                if (hasBottomView) {
                    document.addEventListener('click', handleOutsideClick);
                }

                // Re-enable transitions after all views are positioned
                setTimeout(() => {
                    views.forEach(viewId => {
                        const targetDiv = document.getElementById(viewId);
                        if (targetDiv) {
                            if (viewAnimations[viewId] === 'bottom') {
                                targetDiv.style.transition = "transform 0.3s ease-in-out";
                            } else {
                                targetDiv.style.transition = "left 0.3s ease-in-out";
                            }
                        }
                    });
                }, 50);
            }

            if (savedBase && savedBase !== currentBase) {
                const currentBaseDiv = document.getElementById(currentBase);
                const newBaseDiv = document.getElementById(savedBase);

                currentBaseDiv.style.opacity = "0";
                currentBaseDiv.style.zIndex = -1;
                newBaseDiv.style.opacity = "1";
                newBaseDiv.style.zIndex = 0;
                currentBase = savedBase;
            }

            if (savedMenuState === 'true') {
                const menuPanel = document.getElementById('menuPanel');
                const contentWrapper = document.getElementById('contentWrapper');
                const menuOverlay = document.getElementById('menuOverlay');

                menuPanel.classList.add('open');
                contentWrapper.classList.add('shifted');
                menuOverlay.classList.add('visible');
                isMenuOpen = true;
            }
        }

        // Save state whenever it changes
        function saveState() {
            localStorage.setItem('viewStack', JSON.stringify(viewStack));
            localStorage.setItem('viewAnimations', JSON.stringify(viewAnimations));
            localStorage.setItem('currentBase', currentBase);
            localStorage.setItem('isMenuOpen', isMenuOpen.toString());
        }

        function saveState() {
            localStorage.setItem('viewStack', JSON.stringify(viewStack));
            localStorage.setItem('viewAnimations', JSON.stringify(viewAnimations));
            localStorage.setItem('currentBase', currentBase);
            localStorage.setItem('isMenuOpen', isMenuOpen.toString());
        }

        // Event listeners
        document.getElementById("open-view1").addEventListener("click", () => openView("view1", "right"));
        document.getElementById("open-view2").addEventListener("click", () => openView("view2", "right"));
        document.getElementById("open-view3").addEventListener("click", () => openView("view3", "bottom"));
        document.getElementById("open-view4").addEventListener("click", () => openView("view4", "right"));

        document.getElementById("close-view1").addEventListener("click", () => closeView("view1"));
        document.getElementById("close-view2").addEventListener("click", () => closeView("view2"));
        document.getElementById("close-view3").addEventListener("click", () => closeView("view3"));
        document.getElementById("close-view4").addEventListener("click", () => closeView("view4"));

        // Hamburger menu event listeners
        document.getElementById('hamburgerButton').addEventListener('click', openMenu);
        document.getElementById('menuOverlay').addEventListener('click', closeMenu);

        // Menu item navigation
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', (e) => {
                const baseId = e.target.getAttribute('data-base');
                if (baseId) {
                    switchBaseView(baseId);
                    closeMenu();
                }
            });
        });

        window.addEventListener('DOMContentLoaded', loadState);
    </script>
</body>

</html>